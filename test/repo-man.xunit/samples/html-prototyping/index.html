<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Our Repo</title>
    <script>
      const svgNamespace = "http://www.w3.org/2000/svg";
      const repoInfo = {
        files: [
          {
            name: "README.md",
            size: 10,
            commits: 1,
            lastCommit: 120,
          },
          {
            name: "GettingStarted.md",
            size: 20,
            commits: 2,
            lastCommit: 100,
          },
        ],
        folders: [
          {
            name: "src",
            files: [],
            folders: [
              {
                name: "console",
                files: [
                  {
                    name: "Bootstrapper.cs",
                    size: 120,
                    commits: 1,
                    lastCommit: 100,
                  },
                  {
                    name: "Program.cs",
                    size: 20,
                    commits: 5,
                    lastCommit: 60,
                  },
                ],
                folders: [],
              },
              {
                name: "domain",
                files: [
                  {
                    name: "Model.cs",
                    size: 150,
                    commits: 1,
                    lastCommit: 10,
                  },
                  {
                    name: "Context.cs",
                    size: 20,
                    commits: 5,
                    lastCommit: 6,
                  },
                ],
                folders: [],
              },
            ],
          },
        ],
      };
    </script>
    <script>
      let id = 0;

      function createFile(file, id, startingX, startingY) {
        const radius = 40;

        const fileG = document.createElementNS(svgNamespace, "g");
        fileG.setAttribute("class", "file");

        const path = document.createElementNS(svgNamespace, "path");
        const idString = `file_${id.toString(16)}`;
        path.setAttribute("id", idString);
        path.setAttribute("fill", "green");
        path.setAttribute(
          "d",
          `M ${startingX} ${radius} A ${radius} ${radius} 0 1 1 ${startingX} ${
            radius + 1
          }`
        );

        fileG.appendChild(path);

        const text = document.createElementNS(svgNamespace, "text");
        const textPath = document.createElementNS(svgNamespace, "textPath");
        textPath.setAttribute("href", `#${idString}`);
        textPath.innerHTML = file.name;
        text.appendChild(textPath);

        fileG.appendChild(text);
        const newStartingX = startingX + radius * 2 + 10;
        const maxY = startingY + radius * 2 + 10;

        return { fileG, newStartingX, maxY };
      }

      function writeFiles(files, g, startingX, startingY) {
        let maxX = startingX;
        let rowMaxY = startingY;

        for (const file of files) {
          id += 1;

          const { fileG, newStartingX, maxY } = createFile(
            file,
            id,
            startingX,
            startingY
          );

          startingX = newStartingX;
          rowMaxY = Math.max(rowMaxY, maxY);

          g.appendChild(fileG);
        }

        maxX = startingX + 10;

        return { maxX, rowMaxY };
      }
    </script>
    <!-- <script>
      setInterval(() => {
        window.location.reload();
      }, 5000);
    </script> -->
    <style>
      svg {
        border: 1px solid black;
        background-color: burlywood;
      }
      .file text {
        fill: black;
        font-size: 10px;
        font-family: sans-serif;
      }
    </style>
  </head>
  <body>
    <h1>Files Demo</h1>
    <svg id="repoView"></svg>

    <script>
      const svg = document.getElementById("repoView");

      const g = document.createElementNS(svgNamespace, "g");
      g.setAttribute("transform", "translate(10, 10)");
      svg.appendChild(g);

      let startingX = 0;
      let startingY = 0;

      const files = repoInfo.files;

      const fileResult = writeFiles(repoInfo.files, g, startingX, startingY);

      let maxX = fileResult.maxX;
      let rowMaxY = fileResult.rowMaxY;

      for (const folder of repoInfo.folders) {
        //create the g
        const folderG = document.createElementNS(svgNamespace, "g");
        folderG.setAttribute("transform", `translate(0, ${rowMaxY + 10})`);
        g.appendChild(folderG);

        //create the files and add them to the group
        const folderResult = writeFiles(folder.files, folderG, startingX, 0);

        //create the rectangle and add them to the group
      }

      const width = maxX;
      const height = 400;
      svg.setAttribute("width", width);
      svg.setAttribute("height", height);
    </script>
  </body>
</html>
